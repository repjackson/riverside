template(name='tasks')
    .ui.stackable.padded.grid 
        .sixteen.wide.column
            .ui.inline.header 
                +i name='exchange'
                |#{artist_docs.count} tasks
            if current_search 
                i.large.red.circular.link.remove.icon.clear
            .ui.large.input 
                input.task_search(type='text' placeholder='search...' value=current_search)
        .four.wide.column.scrolling
            .ui.header your points #{currentUser.points}
            a.ui.big.icon.button.new_task
                i.big.green.plus.icon
            +i name='tags'
            each picked_tasks_tags
                button.ui.blue.compact.circular.button.unpick_tag(tabindex='0')
                    //- i.remove.icon
                    | #{this}
            each tasks_tag_results
                button.ui.circular.compact.black.button.pick_tag(tabindex="0" class=result_class title=count)
                    |#{name}
                    // small #{count}
        .twelve.wide.column
            unless one_result
                .ui.inline.header(title='result count') #{result_docs.count}
                // +search_input key='title'
                +session_icon_button key='view_mode' value='grid' icon='grid' 
                +session_icon_button key='view_mode' value='list' icon='list'
                
                +sort_direction_toggle
                // +sort_key_toggle
                +session_set key='sort_key' value='_timestamp' label='added' icon='clock'
                +session_set key='sort_key' value='points' label='points' icon='hashtag'
                +session_set key='sort_key' value='views' label='views' icon='eye'
                +session_set key='sort_key' value='intFormedYear' label='year started' icon='calendar'
                // +session_set key='limit' value=10
                // +session_set key='limit' value=25
                // +session_set key='limit' value=100
            .ui.hidden.divider
            if subs_ready
                if session_is 'view_mode' 'grid'
                    .ui.stackable.cards.scrolling
                        if one_result
                            .ui.one.cards
                                each task_docs 
                                    +task_card
                        else
                            .ui.cards
                                each task_docs 
                                    +task_card
                else
                    .ui.large.list 
                        each task_docs 
                            +task_item
            else 
                .ui.center.aligned.basic.segment
                    i.massive.yin.yang.loading.grey.icon


template(name='task_card')
    .card
        .content
            span(title='recipient')
                +i name='lend'
                with _target
                    +user_info
            span.smallscroll
                |!{description}
            a.ui.icon.button.zoomer(href="/task/#{_id}")
                i.right.large.chevron.icon
template(name='task_item')
    .item
        .content
            span(title='recipient')
                +i name='lend'
                with _target
                    +user_info
            span.smallscroll
                |!{description}
            a.ui.icon.button.zoomer(href="/task/#{_id}")
                i.right.large.chevron.icon

template(name='task_view')
    with current_doc
        .ui.stackable.padded.grid
            .centered.row 
                .sixteen.wide.column
                    .ui.inline.small.header viewing task
                    |#{title}
                    a.ui.icon.button(href="/task/#{_id}/edit")
                        i.pencil.icon
                    |#{_when}
                    if complete 
                        i.big.green.checkmark.icon
                    else 
                        i.big.yellow.clock.icon
                    
                .five.wide.column
                    |!{description}
                    |by
                    a(href="/user/#{_author.username}") 
                        img.ui.inline.small.pointer.zoomer.image(src="{{c.url _author.image_id height=500 width=500 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                        .ui.inline.header.pointer.zoomer
                            |#{_author.name}
                    .ui.huge.center.aligned.header
                        |#{amount}pts
                    if currentUser.admin_mode
                        +remove_button
                        +print_this
                    .f14
                        |!{content}
                    .spacer
                    
                    div 
                    if tags
                        i.tags.icon
                        each tags 
                            .ui.big.basic.circular.label #{this}
                    .ui.small.header
                        i.clock.icon
                        | #{_when}
                    .spacer
                    .spacer
                    //- +array_view key='location_tags' label='location_tags' 
                .eleven.wide.column
                    unless complete
                        .ui.button.mark_complete
                            |mark complete 
                    if complete 
                        .ui.button.mark_incomplete
                            |mark incomplete
                    .ui.header 
                        +i name='activity'
                        |activity
                    .ui.list
                        each activity_docs 
                            .item #{body}
                                small #{_when}
                    
                    a.fly_right(href="/user/#{_target.username}")
                        img.ui.circular.centered.fluid.pointer.zoom.image(src="{{c.url _target.image_id height=500 width=500 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                        .ui.large.center.aligned.header.pointer.zoom
                            |#{_target.name}
                                

template(name='task_edit')
    with current_doc
        .ui.stackable.padded.grid
            .row 
                .eight.wide.column
                    .ui.inline.header editing task
                    a.ui.green.big.circular.button.save.zoomer(href="/task/#{_id}") 
                        i.save.large.icon
                        |save
                    +text_edit key='title' label='title'
                    .ui.segment
                        .ui.inline.grey.header author
                        .ui.inline.header
                            img.ui.small.image(src="{{c.url _author.image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                            |#{_author.name}
                    
                    +boolean_edit key='has_assignee' label='has assignee' icon='user' 
                    if has_assignee
                        +single_user_edit key='assignee' label='recipient' icon='donate' 
                    div
                    +boolean_edit key='has_due_date' label='has date' icon='calendar' 
                    if has_due_date
                        +datetime_edit key='due_date' label='due date/time'    
                    div
                    +array_edit key='location_tags' label='location tags' icon='marker' 
                    +boolean_edit key='has_bounty' label='has bounty' icon='coins'
                    if has_bounty
                        +key_value_edit key='bounty' value=10
                        +key_value_edit key='bounty' value=20
                        +key_value_edit key='bounty' value=50
                        +number_edit key='bounty' label='custom bounty'
                    .spacer
                .eight.wide.column
                    +html_edit key='description' label='description'
                    +group_picker
                    // +boolean_edit key='complete' label='complete' icon='checkmark' 
                    .ui.header
                        +i name='eye'
                        |visibility
                    +boolean_edit key='private' label='private' icon='lock'
                    if private 
                        +multi_user_edit key='access_user_ids' label='user picker' 
                    // +boolean_edit key='has_content' icon='content' 
                    // if has_content
                    div
                                        